{% extends "base.html" %}

{% block title %}Dashboard - GridSystem{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto mt-10 p-8 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-3xl shadow-2xl text-gray-100">

    <!-- Header -->
    <h1 class="text-4xl font-extrabold text-cyan-400 mb-4 text-center tracking-wide">ðŸš€ GridSystem Dashboard</h1>
    <p class="text-gray-400 mb-8 text-center">Monitor live trading activity & control your bot in real-time.</p>

    <!-- Trading Controls -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-10">
        <!-- Start Trading -->
        <form action="/start-trading" method="post">
            <button 
                class="w-full bg-cyan-600 hover:bg-cyan-500 text-white py-4 rounded-2xl font-bold shadow-lg transform transition duration-200 hover:scale-105 hover:shadow-cyan-500/50 
                       {% if trading_active %} opacity-40 cursor-not-allowed {% endif %}" 
                {% if trading_active %} disabled {% endif %}>
                â–¶ Start Trading
            </button>
        </form>

        <!-- Stop Trading -->
        <form action="/stop-trading" method="post">
            <button 
                class="w-full bg-gray-700 hover:bg-gray-600 text-white py-4 rounded-2xl font-bold shadow-lg transform transition duration-200 hover:scale-105 hover:shadow-gray-400/50
                       {% if not trading_active %} opacity-40 cursor-not-allowed {% endif %}" 
                {% if not trading_active %} disabled {% endif %}>
                â–  Stop Trading
            </button>
        </form>

        <!-- Panic Close All -->
        <form action="/panic-close" method="post">
            <button 
                class="w-full bg-red-600 hover:bg-red-500 text-white py-4 rounded-2xl font-bold shadow-lg transform transition duration-200 hover:scale-105 hover:shadow-red-500/50
                       {% if trading_active %} opacity-40 cursor-not-allowed {% endif %}" 
                {% if trading_active %} disabled {% endif %}>
                âš  Panic Close All
            </button>
        </form>

        <!-- Cancel All Orders -->
        <form action="/cancel-all" method="post">
            <button 
                class="w-full bg-yellow-500 hover:bg-yellow-400 text-white py-4 rounded-2xl font-bold shadow-lg transform transition duration-200 hover:scale-105 hover:shadow-yellow-500/50
                       {% if trading_active %} opacity-40 cursor-not-allowed {% endif %}" 
                {% if trading_active %} disabled {% endif %}>
                âœ– Cancel All Orders
            </button>
        </form>
    </div>

    <!-- Status Message -->
    {% if status_message %}
    <div class="mt-6 p-4 rounded-2xl font-semibold text-center shadow-md 
        {% if status_type == 'success' %} bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-green-500/40 
        {% elif status_type == 'error' %} bg-gradient-to-r from-red-500 to-pink-600 text-white shadow-red-500/40 
        {% elif status_type == 'info' %} bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-cyan-500/40 
        {% else %} bg-gray-700 text-gray-200 shadow-gray-500/30 {% endif %}">
        {{ status_message }}
    </div>
    {% endif %}

    <!-- Live Info Cards -->
    <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-8">

        <!-- Active Positions -->
        <div class="bg-gray-800/70 backdrop-blur-lg p-6 rounded-2xl shadow-xl border border-gray-700">
            <h2 class="text-2xl font-bold mb-4 text-cyan-400">ðŸ“ˆ Active Positions</h2>
            <div class="overflow-auto max-h-96">
                {% if positions %}
                    <ul>
                        {% for pos in positions %}
                        <li class="border-b border-gray-700 py-3 flex justify-between items-center hover:bg-gray-700/30 transition">
                            <span>
                                {{ pos.symbol }} 
                                <span class="font-bold text-sm {{ 'text-green-400' if pos.type == 0 else 'text-red-400' }}">
                                    {{ 'BUY' if pos.type == 0 else 'SELL' }}
                                </span>
                            </span>
                            <span class="text-sm text-gray-300">
                                Lot: {{ pos.volume }} | Ticket: {{ pos.ticket }} | Profit: {{ pos.profit }}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-gray-500">No active positions.</p>
                {% endif %}
            </div>
        </div>

        <!-- Pending Orders -->
        <div class="bg-gray-800/70 backdrop-blur-lg p-6 rounded-2xl shadow-xl border border-gray-700">
            <h2 class="text-2xl font-bold mb-4 text-cyan-400">ðŸ•’ Pending Orders</h2>
            <div class="overflow-auto max-h-96">
                {% if orders %}
                    <ul>
                        {% for order in orders %}
                        <li class="border-b border-gray-700 py-3 flex justify-between items-center hover:bg-gray-700/30 transition">
                            <span>
                                {{ order.symbol }} 
                                <span class="font-bold text-sm 
                                    {% if order.type in [0,2,4] %} text-green-400 {% else %} text-red-400 {% endif %}">
                                    {% if order.type == 0 %} BUY 
                                    {% elif order.type == 1 %} SELL 
                                    {% elif order.type == 2 %} BUY LIMIT 
                                    {% elif order.type == 3 %} SELL LIMIT
                                    {% elif order.type == 4 %} BUY STOP 
                                    {% elif order.type == 5 %} SELL STOP
                                    {% else %} UNKNOWN {% endif %}
                                </span>
                            </span>
                            <span class="text-sm text-gray-300">
                                Remaining: {{ order.volume }} | Ticket: {{ order.ticket }}
                            </span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-gray-500">No pending orders.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Refresh Info -->
    <div class="mt-10 text-center">
        <form action="/" method="get">
            <button class="bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-400 hover:to-cyan-500 text-white py-3 px-8 rounded-2xl font-bold shadow-lg hover:shadow-cyan-400/40 transform transition duration-200 hover:scale-105">
                ðŸ”„ Refresh Live Data
            </button>
        </form>
    </div>

</div>
{% endblock %}
